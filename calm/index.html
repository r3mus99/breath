<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="utf-8">
    <title>Whisky</title>
    <link rel="stylesheet" href="../common.css">
    <style>
        .circle.animated {
            animation-duration: 19s;
        }

        @keyframes breath {
            21% {
                transform: scale(2.0);
            }
            58% {
                transform: scale(2.0);
            }
        }

        #step1 .duration {
            animation-name: change-step1;
            animation-duration: 19s;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        @keyframes change-step1 {
            0% {
                opacity: 1;
                width: 0;
            }
            21% {
                opacity: 1;
                width: 100px;
            }
            26%, 100% {
                opacity: 0;
                width: 100px;
            }
        }

        #step2 .duration {
            animation-name: change-step2;
            animation-duration: 19s;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        @keyframes change-step2 {
            0%, 21% {
                opacity: 1;
                width: 0;
            }
            58% {
                opacity: 1;
                width: 100px;
            }
            63%, 100% {
                opacity: 0;
                width: 100px;
            }
        }

        #step3 .duration {
            animation-name: change-step3;
            animation-duration: 19s;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        @keyframes change-step3 {
            0%, 58% {
                opacity: 1;
                width: 0;
            }
            95% {
                opacity: 1;
                width: 100px;
            }
            100% {
                opacity: 0;
                width: 100px;
            }
        }

        .step.animate-inhale {
            animation-name: inhale;
            animation-duration: 19s;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        @keyframes inhale {
            0%, 26%, 58%, 100% {
                color: var(--inactive-color);
                background-color: transparent;
            }
            5%, 21% {
                color: var(--text-color);
                background-color: var(--dark-accent);
            }
        }

        .step.animate-hold {
            animation-name: hold;
            animation-duration: 19s;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        @keyframes hold {
            0%, 21%, 63%, 100% {
                color: var(--inactive-color);
                background-color: transparent;
            }
            26%, 58% {
                color: var(--text-color);
                background-color: var(--dark-accent);
            }
        }

        .step.animate-exhale {
            animation-name: exhale;
            animation-duration: 19s;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }

        @keyframes exhale {
            0%, 58%, 100% {
                color: var(--inactive-color);
                background-color: transparent;
            }
            63%, 95% {
                color: var(--text-color);
                background-color: var(--dark-accent);
            }
        }
    </style>
</head>
<body>
<div class="controls visible" id="controls">
    <div class="counter" id="count" onclick="resetCounter()"></div>
    <div class="step animate-inhale" id="step1">
        <div class="title">inhale</div>
        <div class="duration"></div>
        4s
    </div>
    <div class="step animate-hold" id="step2">
        <div class="title">hold</div>
        <div class="duration"></div>
        7s
    </div>
    <div class="step animate-exhale" id="step3">
        <div class="title">exhale</div>
        <div class="duration"></div>
        8s
    </div>
</div>
<div class="circle animated" id="circle"></div>

<script>
    class WhiskyBreathingCounter {
        constructor() {
            this.counter = 0;
            this.interval = null;
            this.animationDuration = 19000; // 19 seconds in ms

            this.elements = {
                counter: document.getElementById("count"),
                circle: document.getElementById("circle"),
                steps: document.getElementsByClassName("step"),
                durations: document.getElementsByClassName("duration")
            };

            this.init();
        }

        init() {
            this.updateDisplay();
            this.startInterval();
        }

        updateDisplay() {
            this.elements.counter.textContent = this.counter;
        }

        incrementCounter() {
            this.counter++;
            this.updateDisplay();
        }

        resetAnimations() {
            this.resetElementAnimation(this.elements.circle);
            Array.from(this.elements.steps).forEach(step => this.resetElementAnimation(step));
            Array.from(this.elements.durations).forEach(step => this.resetElementAnimation(step));
        }

        resetElementAnimation(element) {
            element.style.animation = 'none';
            element.offsetHeight; // Trigger reflow
            element.style.animation = null;
        }

        startInterval() {
            this.clearInterval();
            this.interval = setInterval(() => {
                this.incrementCounter();
            }, this.animationDuration);
        }

        clearInterval() {
            if (this.interval) {
                clearInterval(this.interval);
                this.interval = null;
            }
        }

        reset() {
            this.resetAnimations();
            this.counter = 0;
            this.updateDisplay();
            this.startInterval();
        }
    }

    const whiskyBreathingCounter = new WhiskyBreathingCounter();

    function resetCounter() {
        whiskyBreathingCounter.reset();
    }
</script>
</body>
</html>